package launchers;

import java.io.File;
import java.io.FilenameFilter;
import java.io.IOException;

import tasks.ParsePDF;
import utilities.InFile;
import utilities.OutFile;
import utilities.State;

public class ParseNE
{
	public static void main(String args[])
	{
		State st = State.NE;
		
		OutFile out = null;
		try
		{
			out = new OutFile(st.getPath() + "\\NE_county.txt", false);
			out.writeLine("state\t\tyear\tgeographyType\tcandName\toffice\tdistrict\tparty\t"
					+ "locationName\tvotes\tvotePerc");
		}
		catch (IOException e)
		{
			System.err.println("Error opening output file.");
			e.printStackTrace();
		}
		
//		for (Integer year : new int[] {2014}) //State.NE.getYears())
//		{
//			String pdfText = ParsePDF.getText(path + "\\" + year + State.NE.getFileType());
//			String[] pdfLines = pdfText.split("\r\n");
//			System.out.println(pdfLines[952]);
//		}
		
		st = State.NE2;
		for (Integer year : st.getYears())
		{
			System.out.println("Parsing " + year + "...");
			File[] files = new File(st.getPath()).listFiles(new FilenameFilter()
			{
				public boolean accept(File dir, String name)
				{
					if (name.matches("^" + year + "[A-Z]*" + State.NE2.getFileType() + "$")) return true;
					else return false;
				}
			});
			
			for (File file : files)
			{
				String off = file.getName().replace(st.getFileType(), "").replaceAll("\\d", "");
				
				InFile in = null;
				try
				{
					in = new InFile(file);
					String[] header = in.readRowLite("\",\"");
					int countyInd = -1,
							nameInd = -1,
							partyInd = -1,
							votesInd = -1,
							districtInd = -1;
					try
					{
						countyInd = getIndex("County", header);
						nameInd = getIndex("Name", header);
						partyInd = getIndex("Party", header);
						votesInd = getIndex("Votes", header);
						districtInd = getIndex("District#", header);
					}
					catch (Exception e)
					{
						e.printStackTrace();
					}
					
					String[] line;
					while (in.isReady())
					{
						line = in.readRowLite("\",\"");
						out.writeLine("NE\t" + year + "\tcounty\t" + line[nameInd]
							+ "\t" + off + "\t" + line[districtInd] + "\t"
							+ line[partyInd] + "\t" + line[countyInd] + "\t"
							+ line[votesInd] + "\t-1.0");
					}
					
				}
				catch (IOException e)
				{
					System.err.println("Error opening " + file.getPath());
					e.printStackTrace();
				}
				
				in.close();
			}
		}
		
		out.close();
	}
	
	public static int getIndex(String toFind, String[] toSearch) throws Exception
	{
		int index = -1;
		int col = 0;
		
		while (index < 0 && col < toSearch.length)
		{
			if (toSearch[col].equals(toFind))
				index = col;
			col++;
		}
		
		if (index < 0)
			throw new Exception("No column found for search entry " + toFind);
		
		return index;
	}
}
